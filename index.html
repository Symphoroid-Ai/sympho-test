<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>sympho tune</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    body { margin: 0; font-family: 'Helvetica Neue', sans-serif; background: linear-gradient(#0f2027, #203a43, #2c5364); color: white; }
    header, section { padding: 2em; text-align: center; }
    h1 { font-size: 2.5em; margin-bottom: 0.2em; }
    .btn { background: #00bcd4; border: none; padding: 0.8em 1.5em; margin: 0.5em; color: white; font-size: 1em; border-radius: 5px; cursor: pointer; }
    iframe { display: block; border: none; }
    #videoArea_loop { position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    #timerDisplay { position: absolute; font-size: 2em; color: red; z-index: 10; pointer-events: none; }
    .top-left { top: 10px; left: 10px; }
    .top-right { top: 10px; right: 10px; }
    .bottom-left { bottom: 10px; left: 10px; }
    .bottom-right { bottom: 10px; right: 10px; }
    .center { top: 50%; left: 50%; transform: translate(-50%, -50%); }
    #langToggle { position: absolute; top: 10px; right: 10px; }
  </style>
</head>
<body>

<button id="langToggle" class="btn">English</button>

<header>
  <img src="logo_with_silhouette.png" alt="sympho tune logo" width="200"/>
  <h1 data-jp="心と時間に寄り添う、癒しの音楽体験。" data-en="Soothing music that cares for your heart and time."></h1>
  <p data-jp="Focus your time. Tune your mind." data-en="Focus your time. Tune your mind."></p>
  <button class="btn" onclick="showSection('choice')" data-jp="気分で音楽を選ぶ" data-en="Pick music by mood"></button>
  <button class="btn" onclick="showSection('loop')" data-jp="動画にタイマーをつける" data-en="Attach timer to video"></button>
</header>

<section id="choice" style="display:none;">
  <h2 data-jp="sympho choice" data-en="sympho choice"></h2>
  <p data-jp="今日の気分は？" data-en="How do you feel today?"></p>
  <div>
    <button class="btn mood-btn" data-mood="元気" data-jp="元気" data-en="Energetic"></button>
    <button class="btn mood-btn" data-mood="癒し" data-jp="癒し" data-en="Healing"></button>
    <button class="btn mood-btn" data-mood="集中" data-jp="集中" data-en="Focus"></button>
    <button class="btn mood-btn" data-mood="切ない" data-jp="切ない" data-en="Melancholy"></button>
  </div>
  <div id="videoArea_choice"></div>
</section>

<section id="loop" style="display:none;">
  <h2 data-jp="sympho loop" data-en="sympho loop"></h2>
  <input type="text" id="ytUrl" placeholder="YouTube動画のURLを入力" style="width:80%; padding:0.5em;"/>
  <input type="number" id="duration" placeholder="時間" min="0" style="padding:0.5em; width:100px;"/>
  <span data-jp="分" data-en="min"></span>
  <button class="btn" onclick="toggleTimerPosition()" id="positionBtn" data-jp="表示位置：左上" data-en="Position: Top-Left"></button>
  <button class="btn" onclick="startLoop()" data-jp="スタート" data-en="Start"></button>
  <button class="btn" onclick="stopLoop()" data-jp="ストップ" data-en="Stop"></button>
  <div id="videoArea_loop">
    <div id="timerDisplay" class="top-left" style="display:none;"></div>
  </div>
</section>

<script>
let currentLang = 'jp';
let ytPlayer;
let playerReady = false;
const positions = ["top-left", "top-right", "bottom-left", "bottom-right", "center"];
let positionIndex = 0;

document.addEventListener("DOMContentLoaded", () => {
  updateLanguage();
  document.querySelectorAll('.mood-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const mood = btn.dataset.mood;
      const videos = {
        "元気": ["https://www.youtube.com/embed/VIDEO_ID1"],
        "癒し": ["https://www.youtube.com/embed/VIDEO_ID2"],
        "集中": ["https://www.youtube.com/embed/VIDEO_ID3"],
        "切ない": ["https://www.youtube.com/embed/VIDEO_ID4"]
      };
      const chosen = videos[mood][Math.floor(Math.random() * videos[mood].length)];
      document.getElementById("videoArea_choice").innerHTML = `
        <iframe src="${chosen}" allowfullscreen playsinline width="560" height="315"></iframe>
        <p>URL: ${chosen}</p>`;
    });
  });
});

document.getElementById("langToggle").addEventListener("click", () => {
  currentLang = currentLang === 'jp' ? 'en' : 'jp';
  updateLanguage();
});

function updateLanguage() {
  document.querySelectorAll("[data-jp]").forEach(el => {
    el.textContent = el.getAttribute(`data-${currentLang}`);
  });
  document.getElementById("langToggle").textContent = currentLang === 'jp' ? "English" : "日本語";
}

function showSection(section) {
  document.getElementById("choice").style.display = section === "choice" ? "block" : "none";
  document.getElementById("loop").style.display = section === "loop" ? "block" : "none";
}

function toggleTimerPosition() {
  positionIndex = (positionIndex + 1) % positions.length;
  const timer = document.getElementById("timerDisplay");
  timer.className = positions[positionIndex];
  const posText = currentLang === 'jp'
    ? ["左上","右上","左下","右下","中央"][positionIndex]
    : ["Top-Left","Top-Right","Bottom-Left","Bottom-Right","Center"][positionIndex];
  document.getElementById("positionBtn").textContent = (currentLang === 'jp' ? "表示位置：" : "Position: ") + posText;
}

function onYouTubeIframeAPIReady() {
  playerReady = true;
}

function startLoop() {
  const url = document.getElementById("ytUrl").value;
  const videoId = url.match(/(?:youtu\.be\/|v=)([a-zA-Z0-9_-]+)/)?.[1];
  if (!videoId) return alert(currentLang === 'jp' ? "正しいURLを入力してください。" : "Please enter a valid URL.");

  const minutes = parseInt(document.getElementById("duration").value) || 0;
  const totalTime = minutes * 60;
  const timerDisplay = document.getElementById("timerDisplay");
  timerDisplay.className = positions[positionIndex];
  timerDisplay.style.display = minutes > 0 ? "block" : "none";

  document.getElementById("videoArea_loop").innerHTML = `
    <div style="position:relative;">
      <div id="ytPlayer"></div>
      <div id="timerDisplay" class="${positions[positionIndex]}" style="position:absolute; font-size:2em; color:red; z-index:10; pointer-events:none;"></div>
    </div>`;

  if (playerReady) {
    ytPlayer = new YT.Player('ytPlayer', {
      height: '315',
      width: '560',
      videoId: videoId,
      playerVars: {
        playsinline: 1,
        fs: 0
      },
      events: {
        'onReady': function (event) {
          event.target.mute();
          event.target.playVideo();
        },
        'onStateChange': function (evt) {
          if (evt.data === YT.PlayerState.ENDED) {
            evt.target.seekTo(0);
            evt.target.playVideo();
          }
        }
      }
    });
      if (ytPlayer && ytPlayer.pauseVideo) {
    ytPlayer.pauseVideo();  // YouTube動画を一時停止
  }
  isPaused = true;          // タイマーが停止中であることを記録
  clearInterval(timerInterval); // タイマーを停止
  }

  if (minutes > 0) {
    let remaining = totalTime;
    clearInterval(window.timerInterval);
    const display = document.getElementById("timerDisplay");
    window.timerInterval = setInterval(() => {
      const mins = Math.floor(remaining / 60).toString().padStart(2, '0');
      const secs = (remaining % 60).toString().padStart(2, '0');
      display.textContent = `${mins}:${secs}`;
      if (--remaining < 0) {
        clearInterval(window.timerInterval);
        display.textContent = currentLang === 'jp' ? "時間終了" : "Time's up!";
        if (ytPlayer && ytPlayer.stopVideo) ytPlayer.stopVideo();
      }
    }, 1000);
  }
}
</script>
</body>
</html>